---

- hosts: localhost
  
  roles:
    - { role: check server existence, server_region: {{ region }}, server_name: {{ name }} }
    - { role: provision sever on aws, server_region: {{ region }}, server_security_group: {{ security_group }}, server_key_name: {{ key_name }}, server_key_path: {{ key_path }}, server_instance_type: {{ instance_type }}, server_image: {{ image }}, server_count: {{ count }}, server_name: {{ name }}, server_security_group_description: {{ security_group_description }}, when: "{{ serverexists }} == 'no'" }
    
    
- hosts: tag_Name_FTServer

  roles:
    - { role: configure server, port: {{ port }} }
    - { role: perform functional test, artifact_path: {{ artifact_path }}, app_name: {{ app_name }}, functional_test_repo: {{ functional_test_repo }}, funtional_test_report_path: {{ funtional_test_report_path }} }
    - { role: terminate server, server_region: {{ region }} }